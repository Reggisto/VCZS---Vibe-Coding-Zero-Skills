<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Oracle v1.5 | Professional Terminal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --neon: #00ff41; --bg: #0a0b0d; --panel: #111827; }
        body, html { height: 100%; margin: 0; background: var(--bg); color: var(--neon); font-family: monospace; overflow: hidden; }
        .wrapper { display: flex; flex-direction: column; height: 100vh; }
        
        /* 70% Dashboard */
        .dashboard { height: 70%; padding: 10px; display: flex; flex-direction: column; gap: 8px; overflow-y: auto; border-bottom: 2px solid #1e293b; }
        
        /* 30% Log Terminal */
        .terminal { height: 30%; background: #000; padding: 10px; font-size: 10px; overflow-y: auto; color: #888; border-top: 1px solid var(--neon); }
        
        .panel { background: var(--panel); border: 1px solid #1e293b; border-radius: 6px; padding: 12px; }
        .grid-3 { display: grid; grid-template-cols: 1fr 1fr 1fr; gap: 8px; }
        input { background: #1f2937 !important; color: var(--neon) !important; border: 1px solid #374151 !important; text-align: center; width: 100%; padding: 5px; font-size: 14px; border-radius: 4px; }
        .label { font-size: 9px; color: #64748b; text-transform: uppercase; margin-bottom: 4px; display: block; }
        .btn-main { background: var(--neon); color: #000; font-weight: bold; width: 100%; padding: 12px; border-radius: 4px; text-transform: uppercase; cursor: pointer; }
        .status-ok { color: var(--neon); }
        .status-err { color: #ef4444; }
    </style>
</head>
<body>

<div class="wrapper">
    <div class="dashboard">
        <div class="flex justify-between items-center mb-1">
            <span class="text-xs font-bold tracking-tighter">VIBE-ORACLE v1.5 [70/30]</span>
            <span id="token-count" class="text-[10px] font-bold">TOKENS: 0</span>
        </div>

        <div class="panel">
            <span class="label">Configurazione Wallet & Rebalancing</span>
            <div class="grid-3 mb-3">
                <div><span class="label">Dutch %</span><input type="number" id="a-d" value="50" onchange="sync()"></div>
                <div><span class="label">Meteo %</span><input type="number" id="a-m" value="30" onchange="sync()"></div>
                <div><span class="label">Rare %</span><input type="number" id="a-r" value="20" onchange="sync()"></div>
            </div>
            <div class="grid-3">
                <div><span class="label">M -> Dutch %</span><input type="number" id="p-m" value="80"></div>
                <div><span class="label">R -> Dutch %</span><input type="number" id="p-r" value="80"></div>
                <div><span class="label">Exit Target %</span><input type="number" id="exit" value="2"></div>
            </div>
        </div>

        <div class="panel space-y-3">
            <div>
                <span class="label">Gemini API Access</span>
                <input type="password" id="key" placeholder="Incolla Key" class="text-left px-3">
            </div>
            <div class="flex gap-2">
                <button id="m-btn" onclick="tMode()" class="w-1/3 bg-blue-900 text-[10px] py-3 rounded font-bold uppercase">Demo</button>
                <button onclick="boot()" class="btn-main text-xs">Inizializza Sistema</button>
            </div>
        </div>

        <div id="stats-panel" class="panel hidden bg-black border-green-900">
            <div class="grid-3 text-center">
                <div><p class="label">ROI</p><p id="roi" class="text-lg font-bold">+0.00%</p></div>
                <div><p class="label">BTC LIVE</p><p id="btc" class="text-lg font-bold">---</p></div>
                <div><p class="label">Status</p><p id="status" class="text-[10px] uppercase">Idle</p></div>
            </div>
        </div>
    </div>

    <div id="log" class="terminal">
[SYSTEM READY] - In attesa di inizializzazione...
- Proporzioni: 70% Dash / 30% Log
- Auto-Check API abilitato.
    </div>
</div>

<script>
    let isR = false;
    let ws = null;

    function l(m, c='') { 
        const log = document.getElementById('log');
        log.innerHTML += `<div class="${c}">> ${m}</div>`;
        log.scrollTop = log.scrollHeight;
    }

    function tMode() {
        isR = !isR;
        const b = document.getElementById('m-btn');
        b.innerText = isR ? "Real" : "Demo";
        b.className = isR ? "w-1/3 bg-red-900 text-[10px] py-3 rounded font-bold uppercase" : "w-1/3 bg-blue-900 text-[10px] py-3 rounded font-bold uppercase";
    }

    function sync() {
        let d = parseInt(document.getElementById('a-d').value)||0;
        let m = parseInt(document.getElementById('a-m').value)||0;
        let r = parseInt(document.getElementById('a-r').value)||0;
        if(d+m+r > 100) document.getElementById('a-r').value = 100 - (d+m);
    }

    async function boot() {
        const k = document.getElementById('key').value.trim();
        if(!k) { l("ERRORE: API Key mancante", "status-err"); return; }
        
        l("Fase 1: Verifica modelli Gemini...");
        try {
            const mResp = await fetch(`https://generativelanguage.googleapis.com/v1beta/models?key=${k}`);
            const mData = await mResp.json();
            
            if(!mResp.ok) throw new Error(mData.error.message);
            
            const model = mData.models.find(m => m.name.includes('flash'))?.name || "models/gemini-1.5-flash";
            l(`Fase 2: Modello rilevato: ${model.split('/').pop()}`, "status-ok");

            l("Fase 3: Test Handshake Contenuto...");
            const gResp = await fetch(`https://generativelanguage.googleapis.com/v1beta/${model}:generateContent?key=${k}`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ contents: [{ parts: [{ text: "ping" }] }] })
            });
            const gData = await gResp.json();
            
            if(gData.usageMetadata) {
                document.getElementById('token-count').innerText = "TOKENS: " + gData.usageMetadata.totalTokenCount;
                l("Fase 4: Connessione Oracoli e WebSocket...", "status-ok");
                document.getElementById('stats-panel').classList.remove('hidden');
                initWS();
            }
        } catch (e) {
            l("FALLIMENTO: " + e.message, "status-err");
        }
    }

    function initWS() {
        if(ws) ws.close();
        ws = new WebSocket('wss://stream.binance.com:9443/ws/btcusdt@ticker');
        ws.onmessage = (e) => {
            const d = JSON.parse(e.data);
            document.getElementById('btc').innerText = "$" + Math.round(d.c);
            document.getElementById('status').innerText = "Streaming";
        };
        ws.onerror = () => l("ERRORE WS: Controlla VPN", "status-err");
    }
</script>
</body>
</html>
