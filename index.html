<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ORACLE v4.0 | TERMINAL</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body, html { height: 100%; margin: 0; background: #000; color: #00ff41; font-family: monospace; overflow: hidden; }
        .wrapper { display: flex; flex-direction: column; height: 100vh; width: 100vw; }
        
        /* Header & Data */
        .top-bar { display: grid; grid-template-columns: 1fr 1fr; border-bottom: 1px solid #1e293b; height: 80px; }
        .stat-box { display: flex; flex-direction: column; justify-content: center; align-items: center; border-right: 1px solid #1e293b; background: #0a0b0d; }
        .label { font-size: 10px; color: #64748b; text-transform: uppercase; }
        .val { font-size: 24px; font-weight: bold; color: #fff; }

        /* PNL Section */
        .pnl-strip { display: flex; justify-content: space-around; background: #0f1115; padding: 10px 0; border-bottom: 1px solid #1e293b; }
        .pnl-item { text-align: center; }
        .pnl-val { font-size: 14px; font-weight: bold; }

        /* Allocation - Flex grow per coprire lo schermo */
        .allocation-area { flex-grow: 1; padding: 20px; display: flex; flex-direction: column; justify-content: center; gap: 20px; }
        .slide-group { width: 100%; }
        input[type=range] { width: 100%; height: 12px; accent-color: #00ff41; background: #1e293b; border-radius: 5px; appearance: none; }

        /* Bottom Control & Log */
        .bottom-ctrl { background: #0a0b0d; border-top: 1px solid #1e293b; padding: 15px; }
        input[type=password] { background: #000; border: 1px solid #334155; color: #00ff41; width: 100%; padding: 12px; margin-bottom: 10px; border-radius: 4px; font-size: 16px; }
        .btn-init { background: #00ff41; color: #000; font-weight: 900; width: 100%; padding: 15px; border-radius: 4px; font-size: 18px; }
        
        #log { height: 100px; background: #000; font-size: 11px; padding: 10px; overflow-y: auto; color: #58a6ff; border-top: 1px solid #1e293b; }
        .tkn-badge { position: absolute; top: 5px; right: 10px; font-size: 10px; color: #991b1b; }
    </style>
</head>
<body>

<div class="wrapper">
    <div class="top-bar">
        <div class="stat-box">
            <span class="label">BUDGET DEMO</span>
            <input type="number" id="budget" value="1000" class="bg-transparent text-white text-center text-xl font-bold border-none outline-none">
        </div>
        <div class="stat-box">
            <span class="label">BTC LIVE</span>
            <span id="btc" class="val text-green-400">---</span>
        </div>
    </div>

    <div class="pnl-strip">
        <div class="pnl-item"><span class="label">PNL DUTCH</span><div id="pnl-d" class="pnl-val text-white">+$0.00</div></div>
        <div class="pnl-item"><span class="label">PNL METEO</span><div id="pnl-m" class="pnl-val text-white">+$0.00</div></div>
        <div class="pnl-item"><span class="label">PNL RARE</span><div id="pnl-r" class="pnl-val text-white">+$0.00</div></div>
    </div>

    <div class="allocation-area">
        <div class="slide-group">
            <div class="flex justify-between mb-2"><span class="label">DUTCH ARB</span><span id="v-d" class="text-white">50%</span></div>
            <input type="range" id="s-d" min="0" max="100" value="50" oninput="balance('d')">
        </div>
        <div class="slide-group">
            <div class="flex justify-between mb-2"><span class="label">METEO OPS</span><span id="v-m" class="text-white">30%</span></div>
            <input type="range" id="s-m" min="0" max="100" value="30" oninput="balance('m')">
        </div>
        <div class="slide-group">
            <div class="flex justify-between mb-2"><span class="label">RARE OPS</span><span id="v-r" class="text-white">20%</span></div>
            <input type="range" id="s-r" min="0" max="100" value="20" oninput="balance('r')">
        </div>
    </div>

    <div class="bottom-ctrl">
        <div class="relative">
            <input type="password" id="key" placeholder="PASTE API KEY">
            <span id="tkn" class="tkn-badge font-bold">TOKENS: 0</span>
        </div>
        <button onclick="boot()" class="btn-init">INITIALIZE ORACLE v4.0</button>
    </div>

    <div id="log">> SYSTEM READY. Awaiting Handshake...</div>
</div>

<script>
    function l(msg, col='') {
        const log = document.getElementById('log');
        log.innerHTML += `<div style="color:${col}">> ${msg}</div>`;
        log.scrollTop = log.scrollHeight;
    }

    function balance(active) {
        let d = document.getElementById('s-d'), m = document.getElementById('s-m'), r = document.getElementById('s-r');
        let total = parseInt(d.value) + parseInt(m.value) + parseInt(r.value);
        let diff = total - 100;
        if (active === 'd') { m.value = Math.max(0, parseInt(m.value) - diff); r.value = 100 - parseInt(d.value) - parseInt(m.value); }
        else if (active === 'm') { d.value = Math.max(0, parseInt(d.value) - diff); r.value = 100 - parseInt(d.value) - parseInt(m.value); }
        else { d.value = Math.max(0, parseInt(d.value) - diff); m.value = 100 - parseInt(d.value) - parseInt(r.value); }
        document.getElementById('v-d').innerText = d.value + '%';
        document.getElementById('v-m').innerText = m.value + '%';
        document.getElementById('v-r').innerText = r.value + '%';
    }

    async function boot() {
        const key = document.getElementById('key').value.trim();
        if(!key) return l("ERROR: NO KEY", "red");
        
        l("FORCING HANDSHAKE PROTOCOL...");
        
        // Elenco modelli aggiornato al 2024/2025 per bypassare il NOT_FOUND
        const models = [
            'gemini-1.5-flash',
            'gemini-1.5-flash-8b',
            'gemini-2.0-flash-exp',
            'gemini-pro'
        ];

        for(let m of models) {
            try {
                l(`TENTATIVO: ${m}...`);
                const r = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${m}:generateContent?key=${key}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: "ping" }] }] })
                });
                const data = await r.json();

                if(data.candidates) {
                    l(`CONNECTED: ${m.toUpperCase()}`, "#00ff41");
                    document.getElementById('tkn').innerText = "TOKENS: " + data.usageMetadata.totalTokenCount;
                    document.getElementById('tkn').style.color = "#00ff41";
                    return;
                } else {
                    l(`FAIL: ${data.error?.status || "REJECTED"}`, "orange");
                }
            } catch(e) { l("NETWORK ERROR", "red"); }
        }
        l("CRITICAL: ALL MODELS FAILED. API KEY RESTRICTED BY GOOGLE.", "red");
    }

    (function connect() {
        const ws = new WebSocket('wss://stream.binance.com:9443/ws/btcusdt@ticker');
        ws.onmessage = (e) => {
            const data = JSON.parse(e.data);
            document.getElementById('btc').innerText = "$" + Math.round(data.c);
        };
    })();
</script>
</body>
</html>
