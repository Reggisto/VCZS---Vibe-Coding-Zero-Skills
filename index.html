<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ORACLE v7.0 | REBORN</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #000; color: #00ff41; font-family: monospace; margin: 0; padding: 10px; min-height: 100vh; display: flex; flex-direction: column; }
        .card { background: #0a0a0a; border: 1px solid #1e293b; padding: 15px; margin-bottom: 10px; border-radius: 8px; }
        .label { font-size: 11px; color: #64748b; text-transform: uppercase; letter-spacing: 1px; }
        .val { font-size: 24px; font-weight: bold; color: #fff; }
        
        /* Terminale ora solido e leggibile */
        #log { background: #000; border: 1px solid #334155; height: 180px; overflow-y: auto; font-size: 11px; padding: 10px; color: #58a6ff; margin-bottom: 10px; }
        
        /* Cursori visibili con traccia verde */
        .slider-box { margin: 15px 0; }
        input[type=range] { width: 100%; height: 8px; background: #1e293b; border-radius: 5px; appearance: none; accent-color: #00ff41; }
        
        /* Bottone enorme a fine pagina */
        .btn-action { background: #00ff41; color: #000; font-weight: 900; width: 100%; padding: 20px; font-size: 18px; border-radius: 8px; cursor: pointer; border: none; text-transform: uppercase; margin-top: auto; }
        input[type=password] { background: #111; border: 1px solid #00ff41; color: #fff; padding: 15px; width: 100%; font-size: 16px; border-radius: 4px; margin-bottom: 10px; text-align: center; }
    </style>
</head>
<body>

<div id="log">> TERMINAL READY v7.0
> Waiting for user handshake...</div>

<div class="card">
    <div class="flex justify-between items-center">
        <div><span class="label">Budget Demo</span><div class="val">$1000</div></div>
        <div class="text-right"><span class="label">BTC/USDT</span><div id="btc" class="val text-green-400">---</div></div>
    </div>
</div>

<div class="card">
    <span class="label">Risk Distribution</span>
    <div class="slider-box">
        <div class="flex justify-between text-[11px]"><span>DUTCH</span><span id="v-d" class="text-white">50%</span></div>
        <input type="range" id="s-d" min="0" max="100" value="50" oninput="balance('d')">
    </div>
    <div class="slider-box">
        <div class="flex justify-between text-[11px]"><span>METEO</span><span id="v-m" class="text-white">30%</span></div>
        <input type="range" id="s-m" min="0" max="100" value="30" oninput="balance('m')">
    </div>
    <div class="slider-box">
        <div class="flex justify-between text-[11px]"><span>RARE</span><span id="v-r" class="text-white">20%</span></div>
        <input type="range" id="s-r" min="0" max="100" value="20" oninput="balance('r')">
    </div>
</div>

<div class="mt-4">
    <input type="password" id="key" placeholder="INCOLLA QUI API KEY">
    <button onclick="boot()" class="btn-action">INITIALIZE ORACLE</button>
</div>

<div class="text-center py-4 opacity-50 text-[10px]">
    API STATUS: <span id="api-status">OFFLINE</span> | TOKENS: <span id="tkn">0</span>
</div>

<script>
    function l(msg, col='') {
        const log = document.getElementById('log');
        log.innerHTML += `<div style="color:${col}">[${new Date().toLocaleTimeString()}] ${msg}</div>`;
        log.scrollTop = log.scrollHeight;
    }

    function balance(active) {
        let d = document.getElementById('s-d'), m = document.getElementById('s-m'), r = document.getElementById('s-r');
        let total = parseInt(d.value) + parseInt(m.value) + parseInt(r.value);
        let diff = total - 100;
        if (active === 'd') { m.value = Math.max(0, parseInt(m.value) - diff); r.value = 100 - parseInt(d.value) - parseInt(m.value); }
        else if (active === 'm') { d.value = Math.max(0, parseInt(d.value) - diff); r.value = 100 - parseInt(d.value) - parseInt(m.value); }
        else { d.value = Math.max(0, parseInt(d.value) - diff); m.value = 100 - parseInt(d.value) - parseInt(r.value); }
        document.getElementById('v-d').innerText = d.value + '%';
        document.getElementById('v-m').innerText = m.value + '%';
        document.getElementById('v-r').innerText = r.value + '%';
    }

    async function boot() {
        const key = document.getElementById('key').value.trim();
        if(!key) return l("ERROR: MISSING KEY", "red");
        
        l("INITIATING NEW API PROTOCOL...");
        
        // Modelli aggiornati con la stringa esatta "models/..."
        const endpoints = [
            {v: 'v1beta', m: 'models/gemini-1.5-flash-latest'},
            {v: 'v1beta', m: 'models/gemini-1.5-flash'},
            {v: 'v1beta', m: 'models/gemini-pro'}
        ];

        for(let ep of endpoints) {
            try {
                l(`Testing: ${ep.m}...`);
                const response = await fetch(`https://generativelanguage.googleapis.com/${ep.v}/${ep.m}:generateContent?key=${key}`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({contents:[{parts:[{text:"test"}]}]})
                });
                
                const data = await response.json();
                if(data.candidates) {
                    l(`SUCCESS: Connected to ${ep.m}`, "#00ff41");
                    document.getElementById('api-status').innerText = "ONLINE";
                    document.getElementById('api-status').style.color = "#00ff41";
                    document.getElementById('tkn').innerText = data.usageMetadata.totalTokenCount;
                    return;
                } else {
                    l(`REJECTED: ${data.error?.message || "Check Key"}`, "orange");
                }
            } catch(e) { l("FETCH FAIL", "red"); }
        }
        l("CRITICAL: AUTH FAILED. Check Google Cloud Console.", "red");
    }

    (function connect() {
        const ws = new WebSocket('wss://stream.binance.com:9443/ws/btcusdt@ticker');
        ws.onmessage = (e) => {
            const data = JSON.parse(e.data);
            document.getElementById('btc').innerText = "$" + Math.round(data.c);
        };
        ws.onerror = () => l("Binance WebSocket Error", "red");
    })();
</script>
</body>
</html>
