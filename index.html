<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ORACLE v3.0 | APEX</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #050505; color: #00ff41; font-family: 'Courier New', monospace; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        .grid-main { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 10px; }
        .panel { background: #0f1115; border: 1px solid #1e293b; border-radius: 4px; padding: 10px; position: relative; }
        .pnl-row { grid-column: span 2; display: flex; justify-content: space-around; background: #0a0c10; padding: 10px; border: 1px solid #1e293b; }
        .label { color: #64748b; font-size: 10px; text-transform: uppercase; margin-bottom: 4px; display: block; }
        .val { font-size: 22px; font-weight: 900; color: #fff; }
        .btc-val { color: #00ff41; font-size: 28px; }
        
        input[type=range] { width: 100%; accent-color: #00ff41; cursor: pointer; height: 6px; }
        input[type=password], input[type=number] { background: #000; color: #00ff41; border: 1px solid #334155; border-radius: 2px; padding: 5px; width: 100%; text-align: center; }
        
        .footer-ctrl { padding: 10px; display: flex; flex-direction: column; gap: 8px; background: #0a0c10; border-top: 1px solid #1e293b; }
        .btn-run { background: #00ff41; color: #000; font-weight: 900; padding: 12px; border-radius: 4px; text-transform: uppercase; width: 100%; transition: 0.2s; }
        .btn-run:active { background: #00cc33; transform: scale(0.98); }
        
        #log { height: 80px; overflow-y: auto; font-size: 9px; color: #58a6ff; padding: 5px; background: #000; border: 1px solid #1e293b; margin-top: 5px; }
        .token-badge { position: absolute; top: 5px; right: 5px; font-size: 9px; background: #991b1b; color: white; padding: 2px 6px; border-radius: 10px; }
    </style>
</head>
<body>

<div class="grid-main">
    <div class="panel">
        <span class="label">BUDGET DEMO</span>
        <input type="number" id="budget" value="1000">
    </div>
    <div class="panel">
        <span class="label">BTC/USDT LIVE</span>
        <div id="btc" class="val btc-val">---</div>
    </div>
    
    <div class="pnl-row">
        <div class="text-center"><span class="label">PNL D</span><div id="pnl-d" class="val text-sm">+$0</div></div>
        <div class="text-center"><span class="label">PNL M</span><div id="pnl-m" class="val text-sm">+$0</div></div>
        <div class="text-center"><span class="label">PNL R</span><div id="pnl-r" class="val text-sm">+$0</div></div>
    </div>

    <div class="panel grid-column span 2" style="grid-column: span 2;">
        <span class="label">RISK ALLOCATION (100%)</span>
        <div class="flex flex-col gap-3 mt-2">
            <div><div class="flex justify-between text-[10px]"><span>DUTCH</span><span id="v-d">50%</span></div><input type="range" id="s-d" oninput="balance('d')"></div>
            <div><div class="flex justify-between text-[10px]"><span>METEO</span><span id="v-m">30%</span></div><input type="range" id="s-m" oninput="balance('m')"></div>
            <div><div class="flex justify-between text-[10px]"><span>RARE</span><span id="v-r">20%</span></div><input type="range" id="s-r" oninput="balance('r')"></div>
        </div>
    </div>
</div>

<div class="footer-ctrl">
    <div class="relative">
        <input type="password" id="key" placeholder="API KEY GEMINI">
        <span id="tkn" class="token-badge">TKN: 0</span>
    </div>
    <button onclick="boot()" class="btn-run">INITIALIZE ORACLE v3.0</button>
    <div id="log">> System Offline. Waiting for Key...</div>
</div>

<script>
    function l(msg, col='') {
        const log = document.getElementById('log');
        log.innerHTML += `<div style="color:${col}">> ${msg}</div>`;
        log.scrollTop = log.scrollHeight;
    }

    function balance(active) {
        let d = document.getElementById('s-d'), m = document.getElementById('s-m'), r = document.getElementById('s-r');
        let total = parseInt(d.value) + parseInt(m.value) + parseInt(r.value);
        let diff = total - 100;
        if (active === 'd') { m.value = Math.max(0, parseInt(m.value) - diff); r.value = 100 - parseInt(d.value) - parseInt(m.value); }
        else if (active === 'm') { d.value = Math.max(0, parseInt(d.value) - diff); r.value = 100 - parseInt(d.value) - parseInt(m.value); }
        else { d.value = Math.max(0, parseInt(d.value) - diff); m.value = 100 - parseInt(d.value) - parseInt(r.value); }
        document.getElementById('v-d').innerText = d.value + '%';
        document.getElementById('v-m').innerText = m.value + '%';
        document.getElementById('v-r').innerText = r.value + '%';
    }

    async function boot() {
        const key = document.getElementById('key').value.trim();
        if(!key) return l("MISSING KEY", "red");
        
        l("INITIATING MULTI-PHASE SCAN...");
        
        // La lista definitiva di modelli che Google DEVE accettare
        const endpoints = [
            {v: 'v1beta', m: 'gemini-1.5-flash-8b'}, 
            {v: 'v1beta', m: 'gemini-1.5-flash'},
            {v: 'v1', m: 'gemini-1.5-flash'},
            {v: 'v1beta', m: 'gemini-pro'}
        ];

        for(let ep of endpoints) {
            try {
                l(`CHECKING ${ep.m}...`);
                const r = await fetch(`https://generativelanguage.googleapis.com/${ep.v}/models/${ep.m}:generateContent?key=${key}`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({contents:[{parts:[{text:"ok"}]}]})
                });
                const data = await r.json();
                if(data.candidates) {
                    document.getElementById('tkn').innerText = "TKN: " + data.usageMetadata.totalTokenCount;
                    document.getElementById('tkn').style.background = "#16a34a";
                    l(`STABLE CONNECTION: ${ep.m}`, "#00ff41");
                    return;
                }
                l(`REJECTED: ${ep.m}`, "orange");
            } catch(e) { l("NET FAIL", "red"); }
        }
        l("CRITICAL ERROR: ALL MODELS NOT FOUND. CHECK API KEY PERMISSIONS.", "red");
    }

    (function connect() {
        const ws = new WebSocket('wss://stream.binance.com:9443/ws/btcusdt@ticker');
        ws.onmessage = (e) => {
            const data = JSON.parse(e.data);
            document.getElementById('btc').innerText = "$" + Math.round(data.c);
        };
    })();
</script>
</body>
</html>
