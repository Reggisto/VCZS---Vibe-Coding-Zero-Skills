    <script>
        var codiceFinale = "";

        async function startGenerazione() {
            var k = document.getElementById('apiKey').value.trim();
            var p = document.getElementById('prompt').value.trim();
            var b = document.getElementById('mainBtn');
            var l = document.getElementById('loading');
            var r = document.getElementById('resultArea');
            var f = document.getElementById('previewFrame');

            if (!k || !p) {
                alert("Inserisci Key e Testo!");
                return;
            }

            b.disabled = true;
            l.classList.remove('hidden');
            r.classList.add('hidden');

            // Lista di tentativi per bypassare l'errore "Not Found" degli screenshot
            // Proviamo i nomi modelli più comuni accettati da Google
            const modelliDaProvare = [
                "gemini-1.5-flash",
                "gemini-1.5-flash-latest",
                "gemini-pro"
            ];

            let successo = false;
            let ultimoErrore = "";

            for (let modello of modelliDaProvare) {
                try {
                    console.log("Tentativo con modello: " + modello);
                    // Usiamo v1beta che è la più flessibile per le key gratuite
                    var url = "https://generativelanguage.googleapis.com/v1beta/models/" + modello + ":generateContent?key=" + k;

                    var res = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{
                                    text: "Genera un file HTML5 unico con CSS Tailwind e JS per questa idea: " + p + ". Restituisci SOLO codice, niente chiacchiere."
                                }]
                            }]
                        })
                    });

                    var data = await res.json();

                    if (res.ok && data.candidates) {
                        var txt = data.candidates[0].content.parts[0].text;
                        codiceFinale = txt.replace(/```html/gi, "").replace(/```/g, "").trim();
                        f.srcdoc = codiceFinale;
                        r.classList.remove('hidden');
                        successo = true;
                        break; // Usciamo dal ciclo se funziona!
                    } else {
                        ultimoErrore = data.error ? data.error.message : "Errore sconosciuto";
                    }
                } catch (e) {
                    ultimoErrore = e.message;
                }
            }

            if (!successo) {
                alert("Nessun modello ha funzionato. Errore API: " + ultimoErrore);
            }

            b.disabled = false;
            l.classList.add('hidden');
        }

        function copiaCodice() {
            if (codiceFinale) {
                navigator.clipboard.writeText(codiceFinale);
                alert("Copiato!");
            }
        }
    </script>
